---
title: React ve TypeScript ile Server Side Rendering NasÄ±l YapÄ±lÄ±r?
excerpt: React, TypeScript, Webpack, ve Node.js ile routing bazlÄ± server side rendering iÅŸlemleri.
image: /images/placeholder.jpg
author:
  - Ali SelÃ§uk
featured: true
date: "05-04-2021"
readingTime: " 30 dk. â˜•â˜•â˜•â˜•ğŸ˜‰"
---

Bu yazÄ±da React, TypeScript, Webpack ve Node.js(express) ile routing bazlÄ± server side rendering nasÄ±l yapÄ±lÄ±r anlatmaya Ã§alÄ±ÅŸacaÄŸÄ±m. Ã–ncelikle Ã§alÄ±ÅŸacaÄŸÄ±mÄ±z
klasÃ¶re geÃ§ip

`npm init --y` diyerek npm'i projemize dahil edelim. `src` adÄ±nda bir klasÃ¶r oluÅŸturup iÃ§erisine `public` adÄ±nda bir klasÃ¶r daha oluÅŸturalÄ±m. Bu klasÃ¶r iÃ§erisine ise
`index.html` adÄ±nda html dosyamÄ±zÄ± oluÅŸturalÄ±m. 

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React & TypeScript Peoject App</title>
</head>

<body>
  <div id="root"></div>
</body>

</html>
```

ArdÄ±ndan react ve typescript'i ekleyelim. **TypeScript** ile ilgili olanlarÄ± **devDependencies** olarak ekleyelim.

```bash
npm install react react-dom

npm install --save-dev typescript @types/react @types/react-dom
```

TypeScript iÃ§in `tsconfig.json` dosyasÄ±nÄ± oluÅŸturalÄ±m.
```json
{
  "compilerOptions": {
    "baseUrl": "src",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "module": "CommonJS",
    "allowJs": true,
    "allowSyntheticDefaultImports": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "strict": false,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react"
  },
  "include": [
    "src"
  ]
}
```

`src` altÄ±na `index.tsx` dosyasÄ±nÄ± oluÅŸturalÄ±m ve iÃ§erisini aÅŸaÄŸÄ±daki gibi dolduralÄ±m. Bu dosya **root** dosyamÄ±z olacaktÄ±r.

```jsx
import React from 'react';
import ReactDOM from 'react-dom';

ReactDOM.render(
  <React.StrictMode>
      <div>Hello React</div>
  </React.StrictMode>,
  document.getElementById('root')
);
```

React ve TypeScript kodlarÄ±mÄ±zÄ±n JavaScript'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmesi ve Ã§alÄ±ÅŸabilmesi iÃ§in
**babel** ayalarÄ±nÄ± yapmamÄ±z gerekiyor bu nedenle aÅŸaÄŸÄ±daki paketleri projeye dahil
edelim. Babel ile ilgili bilgi iÃ§in [Babel](https://babeljs.io/docs/en/) sitesine gÃ¶z
atabilirsiniz.

```bash
npm install --save-dev @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript @babel/plugin-transform-runtime @babel/runtime
```

root dizinde `.babelrc` adÄ±nda bir dosya oluÅŸturalÄ±m ve aÅŸaÄŸÄ±daki ayarlarÄ± ekleyelim.

```json
{
  "presets": [
    "@babel/preset-env",
    "@babel/preset-react",
    "@babel/preset-typescript"
  ],
  "plugins": [
    "@babel/plugin-transform-runtime"
  ]
}
```

bu ayarlardan sonra projeyi ayaÄŸa kaldÄ±rmak iÃ§in ilgili **webpack** paketlerini ve ayarlarÄ±nÄ± ekleyelim. Daha fazla bilgi almak
iÃ§in [Webpack](https://webpack.js.org/) sitesine gÃ¶z atabilirsiniz.

```bash
npm install --save-dev webpack webpack-cli @types/webpack webpack-dev-server @types/webpack-dev-server
```

webpack'in React ve TypeScript kodlarÄ±mÄ±zÄ± anlayÄ±p JavaScript'e nakledebilmesi iÃ§in `babel-loader`'Ä± ekleyelim.

```bash
npm install --save-dev babel-loader
```

proje iÃ§erisinde TypeScript kullanabilmek iÃ§in `ts-node` paketini projeye ekleyelim.

```bash
npm install --save-dev ts-node
```

webpack iÃ§erisinde ilgili html dosyamÄ±zÄ±n bulunabilmesi iÃ§in `html-webpack-plugin` paketini ekleyelim.

```bash
npm install --save-dev html-webpack-plugin
```

root dizinde `webpack.common.js` adÄ±nda bir dosya oluÅŸturalÄ±m ve aÅŸaÄŸÄ±daki ayarlarÄ± ekleyelim.

```javascript
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  mode: "development",
  entry: path.join(__dirname, "src/index.tsx"),
  devtool: "inline-source-map",
  devServer: {
    historyApiFallback: true,
    port: 4000,
    open: true,
    hot: true
  },
  module: {
    rules: [
      {
        test: /\.(ts|js)x?$/i,
        exclude: /node_modules/,
        use: 'babel-loader',
      },
    ],
  },
  resolve: {
    extensions: [".tsx", ".ts", ".js"],
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: path.join(__dirname, "src", "public/index.html"),
    }),
  ]
};
```

tÃ¼m bu ayalardan sonra `package.json` iÃ§erisinde `scripts` bÃ¶lÃ¼mÃ¼nÃ¼ dÃ¼zenleyelim.

```json
  "scripts": {
    "start": "webpack serve --config webpack.common.js"
  },
```

son olarak terminali aÃ§alÄ±m ve `npm start` diyerek projeyi Ã§alÄ±ÅŸtÄ±ralÄ±m ve ekranda 'Hello React' yazÄ±mÄ±zÄ± gÃ¶relim.

![Hello React](/assets/img/posts/react-server-side-rendering/hello-react.png)

projenin temel folder yapÄ±sÄ± aÅŸaÄŸÄ±daki gibidir.

![Base Folder Structure](/assets/img/posts/react-server-side-rendering/base-folder-structure.jpg)

<Divider />

**buraya kadar yaptÄ±ÄŸÄ±mÄ±z tÃ¼m ayarlar temel bir react projesini webpack ile nasÄ±l ayaÄŸa kaldÄ±rabiliriz bu iÅŸlemleri iÃ§ermekteydi. HenÃ¼z server side rendering ile ilgili birÅŸey yapmadÄ±k.
Projemize server side rendering eklemeden Ã¶nce ilgili paketleri projemize ekleyelim.**

yapacaÄŸÄ±mÄ±z server sadece render iÅŸlemi deÄŸil **routing** iÅŸlemlerini de iÃ§eriyor olacaktÄ±r.

```bash
npm install express cors react-router-dom serialize-javascript
```

root dizinde `server` adÄ±nda bir klasÃ¶r oluÅŸturup iÃ§erisine `index.js` adÄ±nda bir dosya oluÅŸturalÄ±m. AÅŸaÄŸÄ±daki kodlarÄ± bu dosya iÃ§erisine ekleyelim.

```javascript
import express from 'express';
import cors from 'cors';
import React from 'react';
import ReactDOM from 'react-dom/server';
import { StaticRouter, matchPath } from 'react-router-dom';
import serialize from 'serialize-javascript';
import App from '../src/App';
import { routes } from '../src/routes';

const app = express()

app.use(cors())
app.use(express.static('build'))

app.get('*', async (req, res) => {

  const activeRoute = routes && routes.find((route) => matchPath(req.url, route));
  let initalData;

  if (activeRoute && activeRoute.fetchInitialData) {
    const fetchedInitialData = await activeRoute.fetchInitialData(req.path);

    initalData = fetchedInitialData;
  }

  const markup = ReactDOM.renderToString(
    <StaticRouter location={req.url} context={{ initalData }}>
      <App />
    </StaticRouter>
  )

  const html = `
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>React & TypeScript Peoject App</title>
        <link href="/main.css" rel="stylesheet">
        <script defer src="/client.js"></script>
        <script>window.__INITIAL_DATA__ = ${serialize(initalData)}</script>
      </head>
      <body>
        <div id="root">${markup}</div>
      </body>
    </html>
  `;

  res.send(html);

})

const PORT = process.env.PORT || 3000

app.listen(PORT, () => {
  console.log(`Server is listening on port: ${PORT}`)
})
```

henÃ¼z routing eklemediÄŸimiz iÃ§in `src` altÄ±na `routes.ts` adÄ±nda bir dosya oluÅŸturalÄ±m. Proje iÃ§erisinde kullanacaÄŸÄ±mÄ±z tÃ¼m routing tanÄ±mlamalarÄ±nÄ± bu dosya iÃ§erisinde yapÄ±yor olacaÄŸÄ±z.

routes dosyasÄ±nÄ± aÅŸaÄŸÄ±daki gibi dÃ¼zenleyelim.

```javascript
import Home from './pages/Home';


export type IRoute = {
  path: string;
  exact?: boolean;
  component: (props) => JSX.Element
}

export const routes: IRoute[] = [
  {
    component: Home,
    exact: true,
    path: '/',
  }
];

```

bu dosya iÃ§erisinde `Home` adÄ±nda bir sayfa Ã§aÄŸÄ±rdÄ±k ancak henÃ¼z bu sayfamÄ±zÄ± oluÅŸturmadÄ±k. `src` altÄ±na `pages` adÄ±nda bir klasÃ¶r oluÅŸturalÄ±m ve iÃ§erisine `Home.tsx` adÄ±nda ilk sayfamÄ±zÄ± ekleyelim.
Ä°Ã§erisini basitÃ§e dolduralÄ±m.

```javascript
import React from 'react';

export default function Home() {
  return (
    <div>
      Home Page
    </div>
  );
}
```

artÄ±k routing yapÄ±mÄ±z olduÄŸu iÃ§in daha Ã¶nce `src` iÃ§erisinde oluÅŸturduÄŸumuz `index.tsx` dosyamÄ±zÄ± gÃ¼ncellememiz gerekiyor. Ä°lgili dosyayÄ± aÅŸaÄŸÄ±daki gibi gÃ¼ncelleyelim.

```javascript
import App from './App';
import { BrowserRouter } from 'react-router-dom';
import React from 'react';
import ReactDOM from 'react-dom';

ReactDOM.render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>,
  document.getElementById('root')
);
```

bu dosyada Ã§aÄŸÄ±rdÄ±ÄŸÄ±mÄ±z `App.tsx` dosyamÄ±z mevcut. Ã–ncelikle bu dosyayÄ± `src` altÄ±na oluÅŸturalÄ±m. Bu dosya iÃ§erisinde `routes` dosyasÄ±nda eklediÄŸimiz routingleri render edeceÄŸiz.
aÅŸaÄŸÄ±daki kodu App dosyamÄ±za ekleyelim.

```javascript
import React from 'react';
import { IRoute, routes } from './routes';
import { Route, Switch } from 'react-router-dom';

export default function App() {
  return (
    <div>

      <Switch>
        {routes.map(({ path, exact, component: C }: IRoute) => (
          <Route key={path} path={path} exact={exact} render={(props) => (
            <C {...props} />
          )} />
        ))}

        <Route path='*'>
          <div>404 - AradÄ±ÄŸÄ±nÄ±z sayfa bulunamadÄ±.</div>
        </Route>
        
      </Switch>
    </div>
  );
}
```

ÅŸimdi birden fazla webpack dosyasÄ± oluÅŸturarak development iÃ§in olanlarÄ± ayrÄ± production iÃ§in olanlarÄ± ayrÄ± ve ortak olan dosyalar iÃ§in ayrÄ± ayarlarÄ± ekleyelim.

root dizinde `webpack.dev.js`, `webpack.prod.js` ve `webpack.config.js` adÄ±nda 3 dosya daha oluÅŸturalÄ±m. (Daha Ã¶nce oluÅŸturduÄŸumuz `webpack.common.js` dosyasÄ±nÄ± silmeyin onu da kullanacaÄŸÄ±z.)

bu dosyalarda kullanacaÄŸÄ±mÄ±z ayarlar iÃ§in aÅŸaÄŸÄ±daki paketleri projeye ekleyelim. **sass** ile ilgili olan paketler opsiyoneldir, projenizde sass kullanacaksanÄ±z ekleyebilirsiniz.

```bash
npm install --save-dev @pmmmwh/react-refresh-webpack-plugin react-refresh webpack-node-externals clean-webpack-plugin webpack-merge mini-css-extract-plugin css-loader sass sass-loader node-sass
```

ilk olarak `webpack.common.js` dosyamÄ±zÄ± aÅŸaÄŸÄ±daki gibi gÃ¼ncelleyelim.

```javascript
const path = require("path");
const { HotModuleReplacementPlugin } = require("webpack");
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
  module: {
    rules: [
      {
        test: /\.(ts|js)x?$/i,
        exclude: /node_modules/,
        use: 'babel-loader',
      },
      {
        test: /\.s?css$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader']
      },
    ],
  },
  resolve: {
    extensions: [".tsx", ".ts", ".js", ".css", ".scss"],
  },
  plugins: [
    new MiniCssExtractPlugin(),
    new HotModuleReplacementPlugin(),
  ],
};
```

daha sonra `webpack.config.js` dosyamÄ±zÄ± aÅŸaÄŸÄ±daki gibi dÃ¼zenleyelim.

```javascript
const { merge } = require("webpack-merge");
const commonConfig = require("./webpack.common.js");

module.exports = ({ env }) => {
  const envConfig = require(`./webpack.${env}.js`);

  if (env === 'prod') {
    const prod_client_config = merge(commonConfig, envConfig["clientConfig"]);
    const prod_server_config = merge(commonConfig, envConfig["serverConfig"]);

    return [prod_client_config, prod_server_config];
  } else {
    
    const dev_config = merge(commonConfig, envConfig);

    return dev_config;
  }
}
```

daha sonra `webpack.dev.js` dosyamÄ±zÄ± aÅŸaÄŸÄ±daki gibi dÃ¼zenleyelim.

```javascript
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');

module.exports = {
  mode: "development",
  entry: path.join(__dirname, "src/index.tsx"),
  devtool: "inline-source-map",
  devServer: {
    historyApiFallback: true,
    port: 4000,
    open: true,
    hot: true
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: path.join(__dirname, "src", "public/index.html"),
    }),
    new ReactRefreshWebpackPlugin(),
  ],
};
```

son olarak `webpack.prod.js` dosyamÄ±zÄ± aÅŸaÄŸÄ±daki gibi dÃ¼zenleyelim.

```javascript
const path = require('path');
const nodeExternals = require('webpack-node-externals');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

const clientConfig = {
  mode: "production",
  entry: path.join(__dirname, "src/index.tsx"),
  output: {
    path: path.resolve(__dirname, "build"),
    filename: "client.js"
  },
  target: 'web',
  devtool: "source-map",
};

const serverConfig = {
  mode: "production",
  entry: path.resolve(__dirname, 'server/index.js'),
  output: {
    path: path.resolve(__dirname, "build"),
    filename: "server.js"
  },
  target: "node",
  externals: [nodeExternals()],
  devtool: "source-map",
  plugins: [
    new CleanWebpackPlugin(),
  ],
};



module.exports = { clientConfig, serverConfig };
```

ÅŸimdi `package.json` dosyamÄ±zda `scripts` kÄ±smÄ±nÄ± yeni webpack ayalarÄ±mÄ±za gÃ¶re gÃ¼ncelleyelim.

```json
  "scripts": {
    "start": "webpack serve --config webpack.config.js --env env=dev",
    "build": "webpack --config webpack.config.js --env env=prod && node build/server.js"
  },
```

Ã¶ncelikle `npm start` diyerek projeyi development modda baÅŸlatalÄ±m ve sorunsuz ÅŸekilde Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶relim. Development mod server side rendering iÃ§ermemektedir.
GeliÅŸtirme yaparken bu modda Ã§alÄ±ÅŸÄ±yor olacaÄŸÄ±z.

ÅŸimdi ise `npm run build` diyerek production iÃ§in ilgili build dosyamÄ±zÄ±n oluÅŸmasÄ±nÄ± saÄŸlayalÄ±m. AynÄ± zamanda `http://localhost:3000/` adresine gidelim ve
projemizin server side ayaÄŸa kalktÄ±ÄŸÄ±nÄ± gÃ¶relim. EÄŸer hatasÄ±z bir ÅŸekilde sayfamÄ±z aÃ§Ä±ldÄ±ysa server side iÅŸlemlerini baÅŸarÄ±yla uyguladÄ±k demektir. Emin olmak iÃ§in  sayfa Ã¼zerinde
**View page source(Sayfa kaynaÄŸÄ±nÄ± incele)** diyerek aÃ§Ä±lan sayfada **root** divi iÃ§erisinde sayfamÄ±zÄ±n render olduÄŸunu gÃ¶rebilirsiniz. Ã–rnek ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±daki gibidir.

![React Server Side Rendering Page Source](/assets/img/posts/react-server-side-rendering/react-ssr-page-source.png)

projemizin son durumdaki klasÃ¶r yapÄ±sÄ± aÅŸaÄŸÄ±daki gibidir.

![Last Folder Structure](/assets/img/posts/react-server-side-rendering/last-folder-structure.png)

projenin github kodlarÄ±na ve daha fazlasÄ±na aÅŸaÄŸÄ±daki link Ã¼zerinden eriÅŸebilirsiniz.

[React SSR App Github](https://github.com/aselcuk/react-ts-ssr-app)

## SonuÃ§

![The Wolf of Wall Street LD](/assets/img/posts/react-server-side-rendering/twows.webp)